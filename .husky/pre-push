#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Run all tests
echo "ğŸ§ª Running all tests..."
npm run test || {
  echo "âŒ Tests failed"
  exit 1
}

# Run test coverage check
echo "ğŸ“Š Checking test coverage..."
npm run test:cov || {
  echo "âŒ Coverage check failed"
  exit 1
}

# Check for console.log statements (except in test files)
echo "ğŸ” Checking for console.log statements..."
if git diff --cached --name-only --diff-filter=ACM | grep -E '\.ts$' | grep -v '\.spec\.ts$' | xargs grep -n 'console\.log' 2>/dev/null; then
  echo "âŒ Found console.log statements. Please remove them before pushing."
  exit 1
fi

# Security audit
echo "ğŸ”’ Running security audit..."
npm audit --audit-level=high || {
  echo "âš ï¸  Security vulnerabilities found. Please review."
  exit 1
}

echo "âœ… Pre-push checks passed!"
